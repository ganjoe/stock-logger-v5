version: '3.8'

services:
  # Dein Python Programm
  stock-logger:
    build: .
    container_name: stock_logger_app
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
      - ./secrets:/app/secrets
      - ./logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true
    restart: always
    depends_on:
      - ib-gateway

  # Das IB Gateway (Hinzugefügt!)
  ib-gateway:
    image: gnzsnz/ib-gateway:latest
    container_name: ib_gateway_app
    restart: always
    environment:
      - TWS_USERID=DEIN_USER
      - TWS_PASSWORD=DEIN_PASSWORT
      - TRADING_MODE=paper # oder live
    ports:
      - "4002:4002" # API Port für Paper Trading
      - "5900:5900" # VNC Port (um mal reinzuschauen)

  # Matrix Chat Bot (PTA via Matrix)
  matrix-bot:
    build: .
    container_name: matrix_bot_app
    command: python main_matrix.py
    volumes:
      - ./data:/app/data
      - ./secrets:/app/secrets
      - ./logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
    restart: always
    depends_on:
      - ib-gateway
